<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>COSMO LIVE Stats</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400..900&display=swap" rel="stylesheet">
  <style>
        /* Global box-sizing for easier sizing */
        * {
          box-sizing: border-box;
        }

        body {
            background-color: #000;
            color: #fff;
            font-family: "Gabarito", sans-serif;
            margin: 0;
            padding: 20px;
        }

        .container {
          max-width: 1000px;  /* Set max width */
          margin: 0 auto;     /* Center horizontally */
          padding: 0 20px;    /* Side padding */
        }

        h1 {
            text-align: center;
            color: #FFE433;
        }

        h2 {
          text-align: center;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #111;
            color: #fff;
            margin-top: 20px;
        }

        th, td {
            border: 1px solid #333;
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #222;
            color: #FFE433;
        }

        tr:nth-child(even) {
            background-color: #1a1a1a;
        }

        tr:hover {
            background-color: #333;
        }

        #table2 th:nth-child(2),
        #table2 td:nth-child(2) {
          width: 5px;
        }

        #table3 th:nth-child(2),
        #table3 td:nth-child(2) {
          width: 5px;
        }

        .search-container {
          text-align: center;
          margin: 30px 0;
        }

        .search-input {
          padding: 12px 20px;
          font-size: 16px;
          width: 60%;
          max-width: 400px;
          border: 2px solid #ffffff44;
          border-radius: 30px;
          background-color: #1e1e1e;
          color: white;
          transition: border 0.3s, box-shadow 0.3s;
        }

        .search-input:focus {
          outline: none;
          border-color: #22aeff;
          box-shadow: 0 0 8px #22aeff66;
        }

        ::placeholder {
          color: #cccccc;
          opacity: 0.7;
        }
        </style>
</head>
<body>
  <div class="container">
    <h1>COSMO LIVE Dashboard</h1>

    <h2>Summary</h2>
    <div class="search-container">
      <input
        type="text"
        id="searchBox"
        class="search-input"
        placeholder="ðŸ” When has your bias done her live?"
      />
    </div>
    <table id="table1"></table>

    <h2>Ranking Leaderboard</h2>
    <h2>(Sorted by No. of Lives)</h2>
    <table id="table2"></table>

    <h2>(Sorted by Total Duration)</h2>
    <table id="table3"></table>
  </div>
  
  <script>
    const nameColorMap = {
      SeoYeon: "#22aeff",
      HyeRin: "#7e00ff",
      JiWoo: "#ffff00",
      ChaeYeon: "#98c64a",
      YooYeon: "#d10a6f",
      SooMin: "#fc83a4",
      NaKyoung: "#6599a4",
      YuBin: "#ffe3e2",
      Kaede: "#ffc935",
      DaHyun: "#ff9ad6",
      Kotone: "#fde000",
      YeonJi: "#5974ff",
      Nien: "#ff953f",
      SoHyun: "#1222b5",
      Xinyu: "#d51313",
      Mayu: "#fe8e76",
      Lynn: "#ab61b8",
      JooBin: "#b8f54d",
      HaYeon: "#52d9ba",
      ShiOn: "#ff428a",
      ChaeWon: "#c7a3e0",
      Sullin: "#7aba8c",
      SeoAh: "#cff2ff",
      JiYeon: "#ffab61"
    };

    function getColorForName(name) {
      return nameColorMap[name] || '';
    }

    let table1AllRows = []; // global storage of all rows for table1 search

    fetch("https://docs.google.com/spreadsheets/d/1jXjnPCKMrbGBhk0wUBLv66YAhcIWO2xZ2yTTL1-LMIM/gviz/tq?tqx=out:json")
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;

        function buildTable(elementId, colIndexes, allRows, rowLimit = null) {
          const table = document.getElementById(elementId);
          table.innerHTML = ''; // clear previous content

          // Create header row
          const header = table.insertRow();
          colIndexes.forEach(i => {
            const th = document.createElement('th');
            th.innerText = json.table.cols[i]?.label || ``;
            header.appendChild(th);
          });

          const slicedRows = rowLimit ? allRows.slice(0, rowLimit) : allRows;

          slicedRows.forEach(r => {
            const row = table.insertRow();
            colIndexes.forEach(i => {
              const cell = row.insertCell();
              const text = r.c[i]?.f || r.c[i]?.v || '';
              cell.innerText = text;

              if (elementId === "table2" && i === 12) {
                const name = r.c[13]?.v || '';
                cell.style.backgroundColor = getColorForName(name);
              }

              if (elementId === "table3" && i === 20) {
                const name = r.c[21]?.v || '';
                cell.style.backgroundColor = getColorForName(name);
              }
            });
          });
        }

        // Store all rows for table1 to enable search filtering
        table1AllRows = rows;

        // Initial render for table1 with all rows
        buildTable("table1", [0,1,2,3,4], table1AllRows);

        // Table 2: L to R â†’ Index 11â€“17, limit 24 rows
        buildTable("table2", [11, 12, 13, 14, 15, 17], rows, 24);

        // Table 3: T to X â†’ Index 19,21,22,23, limit 24 rows
        buildTable("table3", [19, 20, 21, 22, 23], rows, 24);

        // Add search functionality for table1 column 2 (index 1)
        document.getElementById('searchBox').addEventListener('input', function() {
          const query = this.value.toLowerCase();
          const filteredRows = table1AllRows.filter(r => {
            const cellValue = (r.c[2]?.v || '').toString().toLowerCase();
            return cellValue.includes(query);
          });
          buildTable("table1", [0,1,2,3,4], filteredRows);
        });
      });
  </script>
</body>
</html>
