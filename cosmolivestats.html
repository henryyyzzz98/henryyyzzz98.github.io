<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>COSMO LIVE Stats</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gabarito:wght@400..900&display=swap" rel="stylesheet">
  <style>
        /* Global box-sizing for easier sizing */
        * {
          box-sizing: border-box;
        }

        body {
          background: linear-gradient(160deg, #0d0d0d, #1a1a1a);
          color: #fff;
          font-family: "Gabarito", sans-serif;
          margin: 0;
          padding: 20px;
          font-size: 16px;
        }

        .container {
          max-width: 800px;
          margin: 0 auto;
          padding: 0 20px;
        }

        h1 {
            text-align: center;
            color: #FFE433;
        }

        h2 {
          text-align: center;
        }

        .table-container {
          overflow-x: auto;
          margin-top: 20px;
          border-radius: 12px;
        }

        table {
          width: 100%;
          border-collapse: separate;
          border-spacing: 0;
          background-color: #111;
          border-radius: 12px;
          overflow: hidden;
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
        }

        th, td {
          padding: 12px 16px;
          text-align: left;
        }

        th {
          background-color: #1c1c1c;
          color: #FFE433;
          text-transform: uppercase;
          font-size: 13px;
          letter-spacing: 0.5px;
          border-bottom: 2px solid #333;
        }

        td {
          font-size: 15px;
          border-bottom: 1px solid #222;
          vertical-align: middle;
          transition: background-color 0.3s ease;
        }

        tr:nth-child(even) {
          background-color: #151515;
        }

        tr:hover {
          background-color: #222;
        }

        #table3 th:nth-child(1),
        #table3 td:nth-child(1) {
          width: 100px;
        }

        .color-dot {
          display: inline-block;
          width: 12px;
          height: 12px;
          border-radius: 50%;
          margin-right: 8px;
          vertical-align: middle;
        }

        .search-container {
          text-align: center;
          margin: 30px 0;
          position: relative;
        }

        .search-input {
          padding: 12px 20px;
          font-size: 16px;
          width: 60%;
          max-width: 400px;
          border: 2px solid #ffffff44;
          border-radius: 30px;
          background-color: #1e1e1e;
          color: white;
          transition: border 0.3s, box-shadow 0.3s;
        }

        .search-input:focus {
          outline: none;
          border-color: #22aeff;
          box-shadow: 0 0 8px #22aeff66;
        }

        ::placeholder {
          color: #cccccc;
          opacity: 0.7;
        }

        .suggestion-box {
          background: #222;
          color: white;
          max-width: 300px;
          margin: 0 auto;
          border: 1px solid #444;
          border-radius: 8px;
          padding: 5px;
          position: absolute;
          left: 0;
          right: 0;
          top: 100%;
          z-index: 1;
          display: none;
        }

        .suggestion-box.active {
          display: block;
        }

        .suggestion-box div {
          padding: 8px 12px;
          cursor: pointer;
        }

        .suggestion-box div:hover {
          background-color: #333;
        }

        .show-more {
          display: block;
          text-align: center;
          margin: 10px auto;
          padding: 8px 16px;
          border: none;
          border-radius: 20px;
          background-color: #FFE433;
          color: black;
          font-weight: bold;
          cursor: pointer;
        }
        </style>
</head>
<body>
  <div class="container">
    <h1>tripleS COSMO LIVE Stats</h1>

    <h2>Summary</h2>
    <div class="search-container">
      <input
        type="text"
        id="searchBox"
        class="search-input"
        placeholder="ðŸ” When has your bias done her live?"
      />
      <div id="suggestions" class="suggestion-box"></div>
    </div>
    <div class="table-container">
      <table id="table1"></table>
      <button id="showMoreBtn" class="show-more">Show More</button>
    </div>

    <h2>Ranking Leaderboard</h2>
    <h2>(Sorted by No. of Lives)</h2>
    <div class="table-container">
      <table id="table2"></table>
    </div>

    <h2>(Sorted by Total Duration)</h2>
    <div class="table-container">
      <table id="table3"></table>
    </div>
  </div>
  
  <script>
    const nameColorMap = {
      SeoYeon: "#22aeff",
      HyeRin: "#7e00ff",
      JiWoo: "#ffff00",
      ChaeYeon: "#98c64a",
      YooYeon: "#d10a6f",
      SooMin: "#fc83a4",
      NaKyoung: "#6599a4",
      YuBin: "#ffe3e2",
      Kaede: "#ffc935",
      DaHyun: "#ff9ad6",
      Kotone: "#fde000",
      YeonJi: "#5974ff",
      Nien: "#ff953f",
      SoHyun: "#1222b5",
      Xinyu: "#d51313",
      Mayu: "#fe8e76",
      Lynn: "#ab61b8",
      JooBin: "#b8f54d",
      HaYeon: "#52d9ba",
      ShiOn: "#ff428a",
      ChaeWon: "#c7a3e0",
      Sullin: "#7aba8c",
      SeoAh: "#cff2ff",
      JiYeon: "#ffab61"
    };

    const memberNames = Object.keys(nameColorMap);
    let table1AllRows = [], filteredRows = [];
    let showingAll = false;

    function getColorForName(name) {
      return nameColorMap[name] || '';
    }

    fetch("https://docs.google.com/spreadsheets/d/1jXjnPCKMrbGBhk0wUBLv66YAhcIWO2xZ2yTTL1-LMIM/gviz/tq?tqx=out:json")
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;

        function buildTable(elementId, colIndexes, allRows, rowLimit = null) {
          const table = document.getElementById(elementId);
          table.innerHTML = ''; // clear previous content

          // Create header row
          const header = table.insertRow();
          colIndexes.forEach(i => {
            const th = document.createElement('th');
            th.innerText = json.table.cols[i]?.label || ``;
            header.appendChild(th);
          });

          const slicedRows = rowLimit ? allRows.slice(0, rowLimit) : allRows;

          slicedRows.forEach(r => {
            const row = table.insertRow();
            colIndexes.forEach(i => {
              const cell = row.insertCell();
              const text = r.c[i]?.f || r.c[i]?.v || '';

              if ((elementId === "table1" && i === 2) || (elementId === "table2" && i === 13) || (elementId === "table3" && i === 21)) {
                const dot = document.createElement('span');
                dot.className = 'color-dot';
                dot.style.backgroundColor = getColorForName(text);
                cell.appendChild(dot);
                cell.appendChild(document.createTextNode(text));
              } else {
                cell.innerText = text;
              }
            });
          });
        }

        // Store all rows for table1 to enable search filtering
        table1AllRows = rows;
        filteredRows = table1AllRows;

        // Initial render for table1 with all rows
        buildTable("table1", [0,1,2,3,4], filteredRows, 24);

        // Table 2: L to R â†’ Index 11â€“17, limit 24 rows
        buildTable("table2", [11, 13, 14, 15, 17], rows, 24);

        // Table 3: T to X â†’ Index 19,21,22,23, limit 24 rows
        buildTable("table3", [19, 21, 22, 23], rows, 24);

        document.getElementById('showMoreBtn').addEventListener('click', () => {
        showingAll = !showingAll;
        buildTable("table1", [0,1,2,3,4], filteredRows, showingAll ? null : 24);
        document.getElementById('showMoreBtn').innerText = showingAll ? 'Show Less' : 'Show More';
      });

      const searchBox = document.getElementById('searchBox');
      const suggestionsBox = document.getElementById('suggestions');

        searchBox.addEventListener('input', function () {
          const query = this.value.toLowerCase();
          filteredRows = table1AllRows.filter(r => {
            const val = (r.c[2]?.v || '').toString().toLowerCase();
            return val.includes(query);
          });
          buildTable("table1", [0,1,2,3,4], filteredRows, 24);

          if (!query) {
            suggestionsBox.classList.remove('active');
            suggestionsBox.innerHTML = '';
            return;
          }

          const matches = memberNames.filter(name => name.toLowerCase().includes(query));
          suggestionsBox.innerHTML = matches.map(name => `<div>${name}</div>`).join('');
          suggestionsBox.classList.toggle('active', matches.length > 0);
        });

        suggestionsBox.addEventListener('click', function(e) {
          if (e.target.tagName === 'DIV') {
            const selectedName = e.target.textContent;
            searchBox.value = selectedName;
            searchBox.dispatchEvent(new Event('input'));
            suggestionsBox.innerHTML = '';
            suggestionsBox.classList.remove('active');
          }
        });

        document.addEventListener('click', (e) => {
          if (!suggestionsBox.contains(e.target) && e.target !== searchBox) {
            suggestionsBox.classList.remove('active');
          }
        });
      });
  </script>
</body>
</html>
